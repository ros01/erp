<style>
    :root { --c:#1f2937; --m:#6b7280; --b:#2563eb; --bg:#f8fafc; --card:#ffffff; }
    body{margin:0;background:var(--bg);color:var(--c);font-family:system-ui,Segoe UI,Roboto,Arial}
    .wrap{max-width:880px;margin:32px auto;padding:0 16px}
    h1{margin:0 0 12px} p{color:var(--m);margin:0 0 18px}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:18px}
    label{font-weight:600;display:block;margin:10px 0 6px}
    select{width:100%;padding:10px;border:1px solid #e5e7eb;border-radius:10px;background:#fff}
    button{background:var(--b);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
    button[disabled]{opacity:0.5;cursor:not-allowed}
    .row2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .reqs{margin-top:16px}
    .req{display:flex;justify-content:space-between;align-items:center;border:1px solid #e5e7eb;border-radius:10px;padding:10px;margin-bottom:8px;background:#fff}
    .tag{font-size:12px;border-radius:999px;padding:4px 8px;border:1px solid #e5e7eb;color:var(--m)}
    .tag.req{border-color:#ef4444;color:#ef4444}
    .tag.opt{border-color:#6b7280}
    .muted{color:var(--m)}
    .spinner{display:inline-block;width:16px;height:16px;border:2px solid #e5e7eb;border-top-color:var(--b);border-radius:50%;animation:spin 1s linear infinite;margin-right:8px}
    @keyframes spin{to{transform:rotate(360deg)}}
    @media (max-width:680px){.row{grid-template-columns:1fr}}
  </style>

<main class="main">
<div class="container">
  <div class="wrap">
    <h3 class="text-warning">Start Your Visa Application</h3>
    <p>Select a <strong>country</strong> and <strong>visa type</strong> to preview requirements. Then confirm to start your application.</p>

    <div class="card">

      <div class="row2">
        <div>
          <label for="country">Country of Interest</label>
          <select id="country">
            <option value="">— Select country —</option>
          </select>
        </div>
        <div>
          <label for="visaType">Visa Type</label>
          <select id="visaType" disabled>
            <option value="">— Select visa type —</option>
          </select>
        </div>
      </div>

      <div style="margin-top:14px;display:flex;gap:10px;align-items:center">
      <button id="showBtn" type="button" disabled>Show Requirements</button>
      <span id="status" class="muted" aria-live="polite"></span>
      </div>

      <div class="reqs" id="requirements" aria-live="polite"></div>

      <!-- Register CTA, hidden until requirements are loaded -->
      <div class="d-flex justify-content-end" style="margin-top:20px"> 
      <a id="registerLink" href="{% url 'Clients:client-register' %}" 
      class="btn btn-primary file-dl-toast" 
      style="display:none">
      <i class="bx bxs-log-out align-middle me-1"></i> Register to Continue
      </a>
      </div>

      <div id="appResult" class="reqs"></div>


     <!--  <div style="margin-top:14px;display:flex;gap:10px;align-items:center">
        <button id="showBtn" type="button" disabled>Show Requirements</button>
        <span id="status" class="muted" aria-live="polite"></span>
      </div>

      <div class="reqs" id="requirements" aria-live="polite"></div> -->

      <!-- Confirm Application button -->
      <!-- <div style="margin-top:20px">
        <button id="confirmBtn" type="button" disabled>✅ Confirm & Start Application</button> -->

        <!-- <a href="{% url 'Clients:client-register' %}" class="btn btn-primary file-dl-toast">Register</a> -->

      <!-- </div>

      <div class="d-flex justify-content-end"> 
      <a href="{% url 'Clients:client-register' %}" class="btn btn-primary file-dl-toast"><i class="bx bxs-log-out align-middle me-1"></i> Register to Continue</a>`
      </div>


      <div id="appResult" class="reqs"></div> -->

      
    </div>


  </div>
  </div>
  </main>

  <script>
   const API_BASE = "/api";
    const countrySel = document.getElementById("country");
    const visaSel = document.getElementById("visaType");
    const showBtn = document.getElementById("showBtn");
    const statusEl = document.getElementById("status");
    const reqsEl = document.getElementById("requirements");
    const registerLink = document.getElementById("registerLink");

    async function fetchJSON(url, opts={}){
      const res = await fetch(url, {
        headers: { "Content-Type": "application/json", ...opts.headers },
        credentials: "include",
        method: opts.method || "GET",
        body: opts.body ? JSON.stringify(opts.body) : undefined
      });
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    function resetVisaTypes(disabled=true){
      visaSel.innerHTML = `<option value="">— Select visa type —</option>`;
      visaSel.disabled = disabled;
    }

    function resetRequirements(){
      reqsEl.innerHTML = "";
      registerLink.style.display = "none"; // hide register until new reqs shown
    }

    // Load countries
    (async function loadCountries(){
      try{
        const countries = await fetchJSON(`${API_BASE}/countries/`);
        countries.forEach(c=>{
          const opt = document.createElement("option");
          opt.value = c.code;
          opt.textContent = c.name;
          countrySel.appendChild(opt);
        });
      }catch(e){ console.error(e); }
    })();

    // Country → visa types
    countrySel.addEventListener("change", async ()=>{
      resetVisaTypes();
      resetRequirements();
      const country = countrySel.value;
      if(!country){ resetVisaTypes(true); return; }
      try{
        const visaTypes = await fetchJSON(`${API_BASE}/visa-types/?country=${encodeURIComponent(country)}`);
        visaTypes.forEach(v=>{
          const opt = document.createElement("option");
          opt.value = v.code;
          opt.textContent = v.name;
          visaSel.appendChild(opt);
        });
        visaSel.disabled = false;
      }catch(e){ console.error(e); }
    });

    visaSel.addEventListener("change", ()=>{
      showBtn.disabled = !(countrySel.value && visaSel.value);
      resetRequirements();
    });

    // Show requirements
    showBtn.addEventListener("click", async ()=>{
      resetRequirements();
      const country = countrySel.value;
      const visa = visaSel.value;
      if(!country || !visa) return;
      try{
        const reqs = await fetchJSON(`${API_BASE}/requirements/?country=${encodeURIComponent(country)}&visa_type=${encodeURIComponent(visa)}`);
        if(!reqs.length){ 
          reqsEl.innerHTML = "<div class='muted'>No requirements found.</div>"; 
          return; 
        }
        reqs.forEach(r=>{
          const row = document.createElement("div");
          row.className = "req";
          row.innerHTML = `<div><strong>${r.name}</strong><br/><small class="muted">${r.category || "—"}</small></div>
                           <span class="tag ${r.is_mandatory ? "req" : "opt"}">${r.is_mandatory ? "Required" : "Optional"}</span>`;
          reqsEl.appendChild(row);
        });

        // ✅ Show register button after requirements displayed
        registerLink.style.display = "inline-block";

      }catch(e){ console.error(e); }
    });

  </script>


  I tried removing Confirm & Start Application and Select Visa Type became inactivated. Amend script so once requirements are displayed one can Register to Start. Confirm & Start Application btn and related logic is no longer required